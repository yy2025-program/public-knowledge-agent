<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Logistics Knowledge Agent</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 50%, #16213e 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }
        
        body::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 20% 80%, rgba(120, 119, 198, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 119, 198, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(120, 219, 255, 0.1) 0%, transparent 50%);
            pointer-events: none;
        }
        
        /* èŠå¤©å®¹å™¨æ ·å¼ - æ›´æ–°ç‰ˆæœ¬ */
        .chat-container {
            background: rgba(255, 255, 255, 0.05) !important;
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 24px;
            box-shadow: 
                0 32px 64px rgba(0, 0, 0, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            width: 80% !important;
            max-width: 700px !important;
            height: 550px !important;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            position: relative;
            transition: all 0.3s ease;
        }
        
        .chat-container.fullscreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            max-width: none;
            border-radius: 0;
            z-index: 9999;
        }
        
        .chat-container.fullscreen .header {
            padding: 24px 80px 24px 32px; /* ä¸ºå…¨å±æŒ‰é’®ç•™å‡ºç©ºé—´ */
        }
        
        .chat-container.fullscreen .fullscreen-btn {
            top: 24px;
            right: 24px;
        }
        
        .chat-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
        }
        
        /* å…¨å±æŒ‰é’®æ ·å¼ - å¼ºåˆ¶æ˜¾ç¤º */
        .fullscreen-btn {
            position: absolute !important;
            top: 20px !important;
            right: 20px !important;
            width: 40px !important;
            height: 40px !important;
            background: rgba(255, 255, 255, 0.15) !important;
            border: 1px solid rgba(255, 255, 255, 0.3) !important;
            border-radius: 12px;
            cursor: pointer;
            display: flex !important;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            z-index: 100 !important;
            backdrop-filter: blur(10px);
        }
        
        .fullscreen-btn:hover {
            background: rgba(255, 255, 255, 0.25) !important;
            border-color: rgba(255, 255, 255, 0.5) !important;
            transform: scale(1.05);
        }
        
        .fullscreen-btn svg {
            width: 18px !important;
            height: 18px !important;
            fill: rgba(255, 255, 255, 0.9) !important;
            transition: fill 0.3s ease;
        }
        
        .fullscreen-btn:hover svg {
            fill: rgba(255, 255, 255, 1) !important;
        }
        
        .header {
            background: linear-gradient(135deg, rgba(79, 70, 229, 0.8) 0%, rgba(139, 92, 246, 0.8) 100%);
            color: white;
            padding: 32px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            animation: shimmer 3s infinite;
        }
        
        .title-section {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 16px;
            margin-bottom: 24px;
        }
        
        .ai-avatar {
            position: relative;
            animation: float 3s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-8px); }
        }
        
        .ai-avatar svg {
            filter: drop-shadow(0 4px 12px rgba(96, 165, 250, 0.4));
        }
        
        .title-text {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            text-align: left;
            justify-content: center;
        }
        
        .title-text h1 {
            font-size: 2.4rem;
            font-weight: 700;
            margin: 0;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
            letter-spacing: -0.02em;
            line-height: 1.1;
        }
        
        @keyframes shimmer {
            0% { left: -100%; }
            100% { left: 100%; }
        }
        
        .header .nav-links {
            margin-top: 20px;
        }
        
        .header .nav-links a {
            color: rgba(255, 255, 255, 0.9);
            text-decoration: none;
            margin: 0 12px;
            padding: 8px 16px;
            background: rgba(255, 255, 255, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            font-size: 13px;
            font-weight: 500;
            transition: all 0.3s ease;
            display: inline-block;
            cursor: pointer;
        }
        
        .header .nav-links a:hover {
            background: rgba(255, 255, 255, 0.25);
            border-color: rgba(255, 255, 255, 0.4);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }
        
        .api-status {
            padding: 16px 24px;
            text-align: center;
            font-size: 13px;
            font-weight: 500;
            background: rgba(15, 23, 42, 0.6);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
        }
        
        .api-status.connected {
            background: rgba(16, 185, 129, 0.1);
            color: #10b981;
            border-bottom-color: rgba(16, 185, 129, 0.2);
        }
        
        .api-status.connected::before {
            content: '';
            position: absolute;
            left: 24px;
            top: 50%;
            transform: translateY(-50%);
            width: 8px;
            height: 8px;
            background: #10b981;
            border-radius: 50%;
            box-shadow: 0 0 12px rgba(16, 185, 129, 0.6);
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .api-status.disconnected {
            background: rgba(239, 68, 68, 0.1);
            color: #ef4444;
            border-bottom-color: rgba(239, 68, 68, 0.2);
        }
        
        .chat-box {
            flex: 1;
            padding: 24px;
            overflow-y: auto;
            background: rgba(15, 23, 42, 0.3);
            position: relative;
        }
        
        .chat-box::-webkit-scrollbar {
            width: 6px;
        }
        
        .chat-box::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 3px;
        }
        
        .chat-box::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 3px;
        }
        
        .chat-box::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        
        .message {
            margin-bottom: 20px;
            padding: 16px 20px;
            border-radius: 16px;
            max-width: 85%;
            word-wrap: break-word;
            line-height: 1.6;
            position: relative;
            animation: messageSlide 0.3s ease-out;
        }
        
        @keyframes messageSlide {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .user-message {
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            color: white;
            margin-left: auto;
            box-shadow: 0 4px 16px rgba(79, 70, 229, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .bot-message {
            background: rgba(255, 255, 255, 0.08);
            color: #e2e8f0;
            margin-right: auto;
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
        }
        
        .bot-message a {
            color: #60a5fa;
            text-decoration: none;
            border-bottom: 1px solid rgba(96, 165, 250, 0.3);
            transition: all 0.2s ease;
        }
        
        .bot-message a:hover {
            color: #93c5fd;
            border-bottom-color: rgba(147, 197, 253, 0.6);
        }
        
        .input-area {
            padding: 24px;
            background: rgba(15, 23, 42, 0.6);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            gap: 12px;
            backdrop-filter: blur(10px);
        }
        
        .input-area input {
            flex: 1;
            padding: 16px 20px;
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 12px;
            font-size: 15px;
            color: #e2e8f0;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }
        
        .input-area input::placeholder {
            color: rgba(226, 232, 240, 0.5);
        }
        
        .input-area input:focus {
            outline: none;
            border-color: #4f46e5;
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.2);
            background: rgba(255, 255, 255, 0.12);
        }
        
        .input-area button {
            padding: 16px 24px;
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            color: white;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-size: 15px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 16px rgba(79, 70, 229, 0.3);
            position: relative;
            overflow: hidden;
        }
        
        .input-area button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }
        
        .input-area button:hover::before {
            left: 100%;
        }
        
        .input-area button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(79, 70, 229, 0.4);
        }
        
        .input-area button:disabled {
            background: rgba(100, 116, 139, 0.5);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 16px;
            color: rgba(226, 232, 240, 0.7);
            font-size: 14px;
            background: rgba(15, 23, 42, 0.4);
            margin: 0 24px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .loading::before {
            content: '';
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid rgba(226, 232, 240, 0.3);
            border-top: 2px solid #4f46e5;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 8px;
            vertical-align: middle;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
    <script src="bedrock-integration.js"></script>
    <script src="github-models-integration.js"></script>
</head>
<body>
    <div class="chat-container" id="chatContainer">
        <div class="fullscreen-btn" onclick="toggleFullscreen()" id="fullscreenBtn" title="å…¨å±/é€€å‡ºå…¨å±">
            <svg id="fullscreenIcon" viewBox="0 0 24 24">
                <path d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"/>
            </svg>
        </div>
        
        <div class="header">
            <div class="title-section">
                <div class="ai-avatar">
                    <svg width="48" height="48" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <defs>
                            <linearGradient id="aiGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:#60a5fa"/>
                                <stop offset="50%" style="stop-color:#a78bfa"/>
                                <stop offset="100%" style="stop-color:#f472b6"/>
                            </linearGradient>
                            <filter id="glow">
                                <feGaussianBlur stdDeviation="3" result="coloredBlur"/>
                                <feMerge> 
                                    <feMergeNode in="coloredBlur"/>
                                    <feMergeNode in="SourceGraphic"/>
                                </feMerge>
                            </filter>
                        </defs>
                        <!-- AI Brain Core -->
                        <circle cx="24" cy="24" r="20" fill="url(#aiGradient)" opacity="0.2" filter="url(#glow)"/>
                        <circle cx="24" cy="24" r="16" fill="none" stroke="url(#aiGradient)" stroke-width="2" opacity="0.6"/>
                        
                        <!-- Neural Network Nodes -->
                        <circle cx="24" cy="12" r="2" fill="url(#aiGradient)"/>
                        <circle cx="36" cy="20" r="2" fill="url(#aiGradient)"/>
                        <circle cx="36" cy="28" r="2" fill="url(#aiGradient)"/>
                        <circle cx="24" cy="36" r="2" fill="url(#aiGradient)"/>
                        <circle cx="12" cy="28" r="2" fill="url(#aiGradient)"/>
                        <circle cx="12" cy="20" r="2" fill="url(#aiGradient)"/>
                        
                        <!-- Neural Connections -->
                        <path d="M24 12 L36 20 L36 28 L24 36 L12 28 L12 20 Z" fill="none" stroke="url(#aiGradient)" stroke-width="1" opacity="0.4"/>
                        <path d="M24 12 L24 36 M12 20 L36 28 M12 28 L36 20" stroke="url(#aiGradient)" stroke-width="1" opacity="0.3"/>
                        
                        <!-- Central Processing Unit -->
                        <circle cx="24" cy="24" r="4" fill="url(#aiGradient)" opacity="0.8"/>
                        <circle cx="24" cy="24" r="2" fill="white" opacity="0.9"/>
                    </svg>
                </div>
                <div class="title-text">
                    <h1>AI Logistics Knowledge Agent</h1>
                </div>
            </div>
            <div class="nav-links">
                <a href="#" onclick="checkAdminAccess('admin.html')" target="_blank">âš™ï¸ ç®¡ç†é¢æ¿</a>
                <a href="#" onclick="checkAdminAccess('firecrawl-manager.html')" target="_blank">ğŸ”¥ çˆ¬å–ç®¡ç†</a>
            </div>
        </div>
        
        <div id="apiStatus" class="api-status">
            ğŸ”„ æ­£åœ¨æ£€æµ‹APIè¿æ¥çŠ¶æ€...
        </div>
        
        <div id="chatBox" class="chat-box">
            <div class="message bot-message">
                ğŸ‘‹ ä½ å¥½ï¼æˆ‘æ˜¯AIçŸ¥è¯†åŠ©æ‰‹ï¼Œå¯ä»¥å›ç­”seller facingçš„ç‰©æµä¸“ä¸šé—®é¢˜ï¼Œè¯·é—®æœ‰ä»€ä¹ˆå¯ä»¥å¸®åŠ©æ‚¨çš„å—ï¼Ÿ
            </div>
        </div>
        
        <div class="loading" id="loading">
            ğŸ¤” æ­£åœ¨æ€è€ƒä¸­...
        </div>
        
        <div class="input-area">
            <input type="text" id="questionInput" placeholder="è¾“å…¥æ‚¨çš„é—®é¢˜..." onkeypress="handleKeyPress(event)">
            <button onclick="askQuestion()" id="askButton">å‘é€</button>
        </div>
    </div>

    <script>
        // APIé…ç½® - ä½¿ç”¨JSONPlaceholderä½œä¸ºæ¨¡æ‹ŸAPI
        const API_BASE_URL = 'https://jsonplaceholder.typicode.com';
        let useRealAPI = true; // ä½¿ç”¨æ¨¡æ‹ŸAPI

        // åˆå§‹åŒ–AIæœåŠ¡
        let bedrockAI = null;
        let githubModelsAI = null;
        let useBedrockAI = false;
        let useGitHubModels = false;

        // æ£€æµ‹APIè¿æ¥çŠ¶æ€
        async function checkAPIStatus() {
            try {
                // ä¼˜å…ˆæ£€æŸ¥GitHub Models API
                const githubToken = localStorage.getItem('github_models_token');
                if (githubToken) {
                    githubModelsAI = new GitHubModelsAI();
                    const isGitHubWorking = await githubModelsAI.testConnection();
                    if (isGitHubWorking) {
                        useRealAPI = true;
                        useGitHubModels = true;
                        useBedrockAI = false;
                        const modelInfo = githubModelsAI.getCurrentModelInfo();
                        updateAPIStatus('connected', `ğŸ¤– GitHub Models AIå·²è¿æ¥ (${modelInfo.name}) - ä½¿ç”¨å…è´¹AIé—®ç­”`);
                        return;
                    }
                }

                // æ£€æŸ¥æ˜¯å¦é…ç½®äº†Bedrock API
                const bedrockKey = localStorage.getItem('bedrock_api_key');
                if (bedrockKey) {
                    bedrockAI = new BedrockAI();
                    const isBedrockWorking = await bedrockAI.testConnection();
                    if (isBedrockWorking) {
                        useRealAPI = true;
                        useBedrockAI = true;
                        useGitHubModels = false;
                        updateAPIStatus('connected', 'ğŸ¤– Amazon Bedrock AIå·²è¿æ¥ - ä½¿ç”¨é«˜çº§AIé—®ç­”');
                        return;
                    }
                }

                // æµ‹è¯•åŸºç¡€ç½‘ç»œè¿æ¥
                const response = await fetch('https://jsonplaceholder.typicode.com/posts/1');
                
                if (response.ok) {
                    useRealAPI = true;
                    useBedrockAI = false;
                    useGitHubModels = false;
                    updateAPIStatus('connected', 'âœ… ç½‘ç»œè¿æ¥æ­£å¸¸ - ä½¿ç”¨æœ¬åœ°æ™ºèƒ½é—®ç­” | <a href="ai-config.html" target="_blank" style="cursor: pointer; text-decoration: underline; margin-left: 10px; color: #60a5fa;">ğŸš€ é…ç½®AIå¢å¼º</a>');
                } else {
                    throw new Error('ç½‘ç»œè¿æ¥å¼‚å¸¸');
                }
            } catch (error) {
                useRealAPI = false;
                useBedrockAI = false;
                useGitHubModels = false;
                updateAPIStatus('disconnected', 'âš ï¸ ç½‘ç»œè¿æ¥å¼‚å¸¸ - ä½¿ç”¨ç¦»çº¿æ¨¡å¼ | <a href="ai-config.html" target="_blank" style="cursor: pointer; text-decoration: underline; margin-left: 10px; color: #60a5fa;">ğŸš€ é…ç½®AIå¢å¼º</a>');
            }
        }

        function updateAPIStatus(status, message) {
            const statusElement = document.getElementById('apiStatus');
            statusElement.className = `api-status ${status}`;
            statusElement.innerHTML = message; // ä½¿ç”¨innerHTMLæ”¯æŒHTMLå†…å®¹
        }

        // å¢å¼ºçš„æœ¬åœ°çŸ¥è¯†åº“
        const enhancedKnowledge = {
            "äººå·¥æ™ºèƒ½": {
                content: "äººå·¥æ™ºèƒ½ï¼ˆAIï¼‰æ˜¯è®¡ç®—æœºç§‘å­¦çš„ä¸€ä¸ªåˆ†æ”¯ï¼Œè‡´åŠ›äºåˆ›å»ºèƒ½å¤Ÿæ‰§è¡Œé€šå¸¸éœ€è¦äººç±»æ™ºèƒ½çš„ä»»åŠ¡çš„ç³»ç»Ÿã€‚å®ƒåŒ…æ‹¬æœºå™¨å­¦ä¹ ã€æ·±åº¦å­¦ä¹ ã€è‡ªç„¶è¯­è¨€å¤„ç†ã€è®¡ç®—æœºè§†è§‰ç­‰å¤šä¸ªå­é¢†åŸŸã€‚AIçš„ç›®æ ‡æ˜¯è®©æœºå™¨èƒ½å¤Ÿç†è§£ã€å­¦ä¹ ã€æ¨ç†å’Œè§£å†³é—®é¢˜ã€‚",
                keywords: ["ai", "æ™ºèƒ½", "artificial", "äººå·¥æ™ºèƒ½"]
            },
            "æœºå™¨å­¦ä¹ ": {
                content: "æœºå™¨å­¦ä¹ æ˜¯äººå·¥æ™ºèƒ½çš„ä¸€ä¸ªå­é›†ï¼Œå®ƒä½¿è®¡ç®—æœºèƒ½å¤Ÿåœ¨æ²¡æœ‰æ˜ç¡®ç¼–ç¨‹çš„æƒ…å†µä¸‹å­¦ä¹ å’Œæ”¹è¿›ã€‚é€šè¿‡ç®—æ³•åˆ†æå¤§é‡æ•°æ®ï¼Œè¯†åˆ«æ¨¡å¼ï¼Œå¹¶åšå‡ºé¢„æµ‹æˆ–å†³ç­–ã€‚ä¸»è¦åŒ…æ‹¬ç›‘ç£å­¦ä¹ ã€æ— ç›‘ç£å­¦ä¹ å’Œå¼ºåŒ–å­¦ä¹ ä¸‰ç§ç±»å‹ã€‚",
                keywords: ["å­¦ä¹ ", "ml", "machine learning", "ç®—æ³•", "æ•°æ®"]
            },
            "æ·±åº¦å­¦ä¹ ": {
                content: "æ·±åº¦å­¦ä¹ æ˜¯æœºå™¨å­¦ä¹ çš„ä¸€ä¸ªå­é›†ï¼Œä½¿ç”¨å¤šå±‚ç¥ç»ç½‘ç»œæ¥æ¨¡æ‹Ÿäººè„‘çš„å·¥ä½œæ–¹å¼ã€‚å®ƒåœ¨å›¾åƒè¯†åˆ«ã€è¯­éŸ³è¯†åˆ«ã€è‡ªç„¶è¯­è¨€å¤„ç†ç­‰é¢†åŸŸè¡¨ç°å‡ºè‰²ã€‚æ·±åº¦å­¦ä¹ æ¨¡å‹èƒ½å¤Ÿè‡ªåŠ¨å­¦ä¹ æ•°æ®çš„å±‚æ¬¡åŒ–ç‰¹å¾è¡¨ç¤ºã€‚",
                keywords: ["æ·±åº¦", "ç¥ç»", "ç½‘ç»œ", "deep", "neural"]
            },
            "çˆ¬è™«": {
                content: "ç½‘ç»œçˆ¬è™«æ˜¯ä¸€ç§è‡ªåŠ¨åŒ–ç¨‹åºï¼Œç”¨äºä»ç½‘ç«™æå–æ•°æ®ã€‚å®ƒå¯ä»¥ç³»ç»Ÿåœ°æµè§ˆç½‘é¡µï¼Œæ”¶é›†ä¿¡æ¯å¹¶å­˜å‚¨åˆ°æ•°æ®åº“ä¸­ï¼Œå¸¸ç”¨äºæ•°æ®æŒ–æ˜ã€ä»·æ ¼ç›‘æ§ã€å†…å®¹èšåˆç­‰åœºæ™¯ã€‚éœ€è¦éµå®ˆrobots.txtåè®®å’Œç½‘ç«™ä½¿ç”¨æ¡æ¬¾ã€‚",
                keywords: ["çˆ¬è™«", "spider", "crawl", "scrape", "æ•°æ®é‡‡é›†"]
            },
            "API": {
                content: "APIï¼ˆåº”ç”¨ç¨‹åºç¼–ç¨‹æ¥å£ï¼‰æ˜¯ä¸åŒè½¯ä»¶åº”ç”¨ç¨‹åºä¹‹é—´é€šä¿¡çš„æ¡¥æ¢ã€‚å®ƒå®šä¹‰äº†è¯·æ±‚å’Œå“åº”çš„æ ¼å¼ï¼Œä½¿å¼€å‘è€…èƒ½å¤Ÿé›†æˆä¸åŒçš„æœåŠ¡å’ŒåŠŸèƒ½ã€‚å¸¸è§çš„APIç±»å‹åŒ…æ‹¬REST APIã€GraphQL APIç­‰ã€‚",
                keywords: ["api", "æ¥å£", "interface", "æœåŠ¡", "é›†æˆ"]
            },
            "FireCrawl": {
                content: "FireCrawlæ˜¯ä¸€ä¸ªå¼ºå¤§çš„ç½‘é¡µçˆ¬å–æœåŠ¡ï¼Œèƒ½å¤Ÿå¤„ç†JavaScriptæ¸²æŸ“çš„é¡µé¢ï¼Œæå–ç»“æ„åŒ–æ•°æ®ï¼Œå¹¶æ”¯æŒå¤šç§è¾“å‡ºæ ¼å¼å¦‚Markdownå’ŒHTMLã€‚å®ƒæä¾›äº†æ¯”ä¼ ç»Ÿçˆ¬è™«æ›´å¼ºå¤§çš„åŠŸèƒ½ï¼ŒåŒ…æ‹¬æ™ºèƒ½å†…å®¹æå–å’Œåçˆ¬è™«å¤„ç†ã€‚",
                keywords: ["firecrawl", "fire", "ç½‘é¡µçˆ¬å–", "javascript"]
            },
            "Supabase": {
                content: "Supabaseæ˜¯ä¸€ä¸ªå¼€æºçš„Firebaseæ›¿ä»£å“ï¼Œæä¾›å®æ—¶æ•°æ®åº“ã€èº«ä»½éªŒè¯ã€å­˜å‚¨ã€è¾¹ç¼˜å‡½æ•°ç­‰æœåŠ¡ã€‚å®ƒåŸºäºPostgreSQLï¼Œæä¾›äº†å¼ºå¤§çš„SQLåŠŸèƒ½ï¼Œç‰¹åˆ«é€‚åˆå¿«é€Ÿæ„å»ºç°ä»£Webåº”ç”¨ç¨‹åºã€‚",
                keywords: ["supabase", "æ•°æ®åº“", "database", "postgresql", "å®æ—¶"]
            },
            "GitHub": {
                content: "GitHubæ˜¯å…¨çƒæœ€å¤§çš„ä»£ç æ‰˜ç®¡å¹³å°ï¼ŒåŸºäºGitç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿã€‚å®ƒä¸ä»…æä¾›ä»£ç å­˜å‚¨ï¼Œè¿˜åŒ…æ‹¬é¡¹ç›®ç®¡ç†ã€CI/CDã€åŒ…ç®¡ç†ç­‰åŠŸèƒ½ã€‚GitHub Pageså¯ä»¥å…è´¹æ‰˜ç®¡é™æ€ç½‘ç«™ã€‚",
                keywords: ["github", "git", "ä»£ç ", "ç‰ˆæœ¬æ§åˆ¶", "å¼€æº"]
            },
            "Vercel": {
                content: "Vercelæ˜¯ä¸€ä¸ªç°ä»£åŒ–çš„å‰ç«¯éƒ¨ç½²å¹³å°ï¼Œä¸“é—¨ä¸ºReactã€Vueã€Next.jsç­‰æ¡†æ¶ä¼˜åŒ–ã€‚å®ƒæä¾›å…¨çƒCDNã€è‡ªåŠ¨HTTPSã€Serverlesså‡½æ•°ç­‰åŠŸèƒ½ï¼Œç‰¹åˆ«é€‚åˆéƒ¨ç½²é™æ€ç½‘ç«™å’Œå…¨æ ˆåº”ç”¨ã€‚",
                keywords: ["vercel", "éƒ¨ç½²", "serverless", "å‰ç«¯", "cdn"]
            }
        };

        async function askQuestion() {
            const questionInput = document.getElementById('questionInput');
            const question = questionInput.value.trim();
            
            if (!question) return;

            // ç¦ç”¨è¾“å…¥å’ŒæŒ‰é’®
            questionInput.disabled = true;
            document.getElementById('askButton').disabled = true;
            document.getElementById('loading').style.display = 'block';

            // æ˜¾ç¤ºç”¨æˆ·é—®é¢˜
            addMessage('user', question);
            questionInput.value = '';

            try {
                let answer;
                
                if (useRealAPI) {
                    // æ·»åŠ ç®€æ´çš„æœç´¢æç¤º
                    addMessage('bot', `ğŸ” æ­£åœ¨æœç´¢çŸ¥è¯†åº“...`);
                    await new Promise(resolve => setTimeout(resolve, 300));
                    
                    // æ£€æŸ¥æ˜¯å¦å¯ç”¨äº†AIæœåŠ¡
                    if (useGitHubModels && githubModelsAI) {
                        console.log('ä½¿ç”¨GitHub Models AIå›ç­”');
                        answer = await generateGitHubModelsAnswer(question, searchCrawledKnowledge(question));
                    } else if (useBedrockAI && bedrockAI) {
                        console.log('ä½¿ç”¨Bedrock AIå›ç­”');
                        answer = await generateBedrockAnswer(question, searchCrawledKnowledge(question));
                    } else {
                        console.log('ä½¿ç”¨æœ¬åœ°æ™ºèƒ½é—®ç­”');
                        answer = generateSmartAnswer(question);
                    }
                } else {
                    // ç¦»çº¿æ¨¡å¼
                    await new Promise(resolve => setTimeout(resolve, 500));
                    answer = generateBasicAnswer(question);
                }
                
                addMessage('bot', answer);
                
            } catch (error) {
                console.error('é—®ç­”å‡ºé”™:', error);
                addMessage('bot', 'æŠ±æ­‰ï¼ŒæœåŠ¡æš‚æ—¶ä¸å¯ç”¨ï¼Œè¯·ç¨åå†è¯•ã€‚');
            } finally {
                // æ¢å¤è¾“å…¥çŠ¶æ€
                questionInput.disabled = false;
                document.getElementById('askButton').disabled = false;
                document.getElementById('loading').style.display = 'none';
                questionInput.focus();
            }
        }
                    }
                    
                    // å¦‚æœä½¿ç”¨AIæœåŠ¡ï¼Œéœ€è¦å¼‚æ­¥å¤„ç†
                    if (useGitHubModels) {
                        answer = await generateGitHubModelsAnswer(question, searchCrawledKnowledge(question));
                    } else if (useBedrockAI) {
                        answer = await generateBedrockAnswer(question, searchCrawledKnowledge(question));
                    } else {
                        answer = generateSmartAnswer(question);
                    }
                } else {
                    // ç¦»çº¿æ¨¡å¼
                    await new Promise(resolve => setTimeout(resolve, 500));
                    answer = generateBasicAnswer(question);
                }
                
                addMessage('bot', answer);
                
            } catch (error) {
                addMessage('bot', 'æŠ±æ­‰ï¼ŒæœåŠ¡æš‚æ—¶ä¸å¯ç”¨ï¼Œè¯·ç¨åå†è¯•ã€‚');
            } finally {
                // æ¢å¤è¾“å…¥çŠ¶æ€
                questionInput.disabled = false;
                document.getElementById('askButton').disabled = false;
                document.getElementById('loading').style.display = 'none';
                questionInput.focus();
            }
        }

        function addMessage(sender, message) {
            const chatBox = document.getElementById('chatBox');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}-message`;
            messageDiv.textContent = message;
            chatBox.appendChild(messageDiv);
            chatBox.scrollTop = chatBox.scrollHeight;
        }

        function generateSmartAnswer(question) {
            const questionLower = question.toLowerCase();
            
            // é¦–å…ˆæœç´¢FireCrawlçˆ¬å–çš„çŸ¥è¯†åº“
            const crawledResults = searchCrawledKnowledge(question);
            console.log('FireCrawlæœç´¢ç»“æœæ•°é‡:', crawledResults.length);
            
            // å¦‚æœå¯ç”¨äº†GitHub Models AIï¼Œä¼˜å…ˆä½¿ç”¨
            if (useGitHubModels && githubModelsAI) {
                return generateGitHubModelsAnswer(question, crawledResults);
            }
            
            // å¦‚æœå¯ç”¨äº†Bedrock AIï¼Œä½¿ç”¨AIå¢å¼ºå›ç­”
            if (useBedrockAI && bedrockAI) {
                return generateBedrockAnswer(question, crawledResults);
            }
            
            if (crawledResults.length > 0) {
                console.log('ä½¿ç”¨FireCrawlçˆ¬å–å†…å®¹å›ç­”');
                return generateAnswerFromCrawledData(question, crawledResults);
            }
            
            console.log('æœªæ‰¾åˆ°FireCrawlå†…å®¹ï¼Œä½¿ç”¨å†…ç½®çŸ¥è¯†åº“');
            
            // ç„¶åæœç´¢å†…ç½®çŸ¥è¯†åº“ - ä½†è¦é¿å…é”™è¯¯åŒ¹é…
            let bestMatch = null;
            let maxScore = 0;

            for (const [topic, data] of Object.entries(enhancedKnowledge)) {
                let score = 0;
                
                // åªæœ‰å½“é—®é¢˜æ˜ç¡®åŒ…å«ä¸»é¢˜è¯æ—¶æ‰åŒ¹é…
                if (question.includes(topic)) {
                    score += 15;
                }
                
                // ä¸¥æ ¼çš„å…³é”®è¯åŒ¹é…
                let keywordMatches = 0;
                for (const keyword of data.keywords) {
                    if (questionLower.includes(keyword.toLowerCase())) {
                        keywordMatches++;
                        score += 8;
                    }
                }
                
                // éœ€è¦è‡³å°‘2ä¸ªå…³é”®è¯åŒ¹é…æ‰è€ƒè™‘
                if (keywordMatches < 2 && !question.includes(topic)) {
                    score = 0;
                }
                
                if (score > maxScore) {
                    maxScore = score;
                    bestMatch = { topic, data, score };
                }
            }

            if (bestMatch && bestMatch.score >= 15) {
                return `å…³äº${bestMatch.topic}ï¼š\n\n${bestMatch.data.content}\n\nğŸ’¡ å¦‚æœæ‚¨æƒ³äº†è§£æ›´å¤šç›¸å…³ä¿¡æ¯ï¼Œå¯ä»¥è¯¢é—®å…¶ä»–æŠ€æœ¯è¯é¢˜ï¼`;
            }

            // å¦‚æœæ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„å†…å®¹ï¼Œæä¾›å¸®åŠ©ä¿¡æ¯
            return generateHelpfulResponse(question);
        }

        // ä½¿ç”¨GitHub Models AIç”Ÿæˆå¢å¼ºå›ç­”
        async function generateGitHubModelsAnswer(question, crawledResults) {
            try {
                console.log('ä½¿ç”¨GitHub Models AIç”Ÿæˆå›ç­”');
                const aiAnswer = await githubModelsAI.enhancedQA(question, crawledResults);
                
                const modelInfo = githubModelsAI.getCurrentModelInfo();
                let response = `ğŸ¤– **AIå¢å¼ºå›ç­” (${modelInfo.name})ï¼š**\n\n${aiAnswer}`;
                
                // å¦‚æœæœ‰çˆ¬å–çš„å†…å®¹ï¼Œæ·»åŠ æ¥æºä¿¡æ¯
                if (crawledResults.length > 0) {
                    response += `\n\nğŸ“š **å‚è€ƒæ¥æºï¼š**\n`;
                    crawledResults.slice(0, 2).forEach(item => {
                        response += `â€¢ ${item.title} - ${item.url}\n`;
                    });
                }
                
                return response;
            } catch (error) {
                console.error('GitHub Models AIè°ƒç”¨å¤±è´¥:', error);
                // é™çº§åˆ°æœ¬åœ°å›ç­”
                if (crawledResults.length > 0) {
                    return generateAnswerFromCrawledData(question, crawledResults);
                }
                return `æŠ±æ­‰ï¼ŒAIæœåŠ¡æš‚æ—¶ä¸å¯ç”¨ã€‚${generateHelpfulResponse(question)}`;
            }
        }

        // ä½¿ç”¨Bedrock AIç”Ÿæˆå¢å¼ºå›ç­”
        async function generateBedrockAnswer(question, crawledResults) {
            try {
                console.log('ä½¿ç”¨Bedrock AIç”Ÿæˆå›ç­”');
                const aiAnswer = await bedrockAI.enhancedQA(question, crawledResults);
                
                let response = `ğŸ¤– **AIå¢å¼ºå›ç­”ï¼š**\n\n${aiAnswer}`;
                
                // å¦‚æœæœ‰çˆ¬å–çš„å†…å®¹ï¼Œæ·»åŠ æ¥æºä¿¡æ¯
                if (crawledResults.length > 0) {
                    response += `\n\nğŸ“š **å‚è€ƒæ¥æºï¼š**\n`;
                    crawledResults.slice(0, 2).forEach(item => {
                        response += `â€¢ ${item.title} - ${item.url}\n`;
                    });
                }
                
                return response;
            } catch (error) {
                console.error('Bedrock AIè°ƒç”¨å¤±è´¥:', error);
                // é™çº§åˆ°æœ¬åœ°å›ç­”
                if (crawledResults.length > 0) {
                    return generateAnswerFromCrawledData(question, crawledResults);
                }
                return `æŠ±æ­‰ï¼ŒAIæœåŠ¡æš‚æ—¶ä¸å¯ç”¨ã€‚${generateHelpfulResponse(question)}`;
            }
        }

        function generateHelpfulResponse(question) {
            const questionLower = question.toLowerCase();
            
            // æ£€æŸ¥æ˜¯å¦æ˜¯å…³äºå·²çˆ¬å–å†…å®¹çš„é—®é¢˜
            const knowledgeBase = JSON.parse(localStorage.getItem('crawled_knowledge_base') || '[]');
            if (knowledgeBase.length > 0) {
                const domains = [...new Set(knowledgeBase.map(item => {
                    try {
                        return new URL(item.url).hostname;
                    } catch {
                        return item.url;
                    }
                }))];
                
                return `æŠ±æ­‰ï¼Œæˆ‘æ²¡æœ‰æ‰¾åˆ°å…³äº"${question}"çš„ç¡®åˆ‡ä¿¡æ¯ã€‚\n\nğŸ” **æœç´¢å»ºè®®ï¼š**\nâ€¢ å°è¯•ä½¿ç”¨æ›´ç®€å•çš„å…³é”®è¯\nâ€¢ æ£€æŸ¥æ‹¼å†™æ˜¯å¦æ­£ç¡®\n\nğŸ“š **å½“å‰çŸ¥è¯†åº“åŒ…å«ï¼š**\n${knowledgeBase.length} æ¡çˆ¬å–å†…å®¹ï¼Œæ¥æºåŒ…æ‹¬ï¼š\n${domains.map(d => `â€¢ ${d}`).join('\n')}\n\nğŸ’¡ **æç¤ºï¼š**\nâ€¢ è®¿é—® <a href="firecrawl-manager.html" target="_blank">FireCrawlç®¡ç†å™¨</a> æŸ¥çœ‹çˆ¬å–å†…å®¹\nâ€¢ å°è¯•çˆ¬å–æ›´å¤šç›¸å…³ç½‘é¡µæ¥æ‰©å±•çŸ¥è¯†åº“\nâ€¢ ä½¿ç”¨ç®¡ç†å™¨ä¸­çš„"çŸ¥è¯†åº“æœç´¢æµ‹è¯•"åŠŸèƒ½è°ƒè¯•`;
            }

            // æ™ºèƒ½æ¨è
            if (questionLower.includes('å¦‚ä½•') || questionLower.includes('æ€ä¹ˆ')) {
                return `å…³äº"${question}"çš„å®ç°æ–¹æ³•ï¼Œæˆ‘å»ºè®®æ‚¨å¯ä»¥ï¼š\n\n1. å…ˆäº†è§£ç›¸å…³çš„åŸºç¡€æ¦‚å¿µ\n2. æŸ¥çœ‹ç›¸å…³çš„æŠ€æœ¯æ–‡æ¡£å’Œæ•™ç¨‹\n3. å®è·µåŠ¨æ‰‹é¡¹ç›®æ¥åŠ æ·±ç†è§£\n\nğŸ”¥ æ‚¨è¿˜å¯ä»¥é€šè¿‡ <a href="firecrawl-manager.html" target="_blank">FireCrawlç®¡ç†å™¨</a> çˆ¬å–ç‰¹å®šç½‘é¡µæ¥è·å–æ›´ä¸“ä¸šçš„ç­”æ¡ˆï¼`;
            }

            if (questionLower.includes('ä»€ä¹ˆ') || questionLower.includes('æ˜¯ä»€ä¹ˆ')) {
                return `"${question}"æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é—®é¢˜ï¼\n\nğŸ¤– æˆ‘çš„å†…ç½®çŸ¥è¯†åº“åŒ…å«ï¼šäººå·¥æ™ºèƒ½ã€æœºå™¨å­¦ä¹ ã€æ·±åº¦å­¦ä¹ ã€çˆ¬è™«ã€APIã€FireCrawlã€Supabaseç­‰æŠ€æœ¯è¯é¢˜ã€‚\n\nğŸ”¥ **æƒ³è¦è·å–æ›´ä¸“ä¸šçš„ç­”æ¡ˆï¼Ÿ**\nä½¿ç”¨ <a href="firecrawl-manager.html" target="_blank">FireCrawlç®¡ç†å™¨</a> çˆ¬å–ç›¸å…³ç½‘é¡µï¼š\nâ€¢ å®˜æ–¹æ–‡æ¡£\nâ€¢ æŠ€æœ¯åšå®¢\nâ€¢ æ•™ç¨‹ç½‘ç«™\nâ€¢ ä¸“ä¸šè®ºå›`;
            }

            return `æ„Ÿè°¢æ‚¨çš„é—®é¢˜"${question}"ï¼\n\nğŸ” **æœç´¢å»ºè®®ï¼š**\nâ€¢ å°è¯•ä½¿ç”¨ä¸åŒçš„å…³é”®è¯\nâ€¢ ç®€åŒ–é—®é¢˜è¡¨è¾¾\nâ€¢ æ£€æŸ¥æ‹¼å†™æ˜¯å¦æ­£ç¡®\n\nğŸš€ **æ‰©å±•çŸ¥è¯†åº“ï¼š**\nè®¿é—® <a href="firecrawl-manager.html" target="_blank">FireCrawlç®¡ç†å™¨</a> çˆ¬å–ç›¸å…³ç½‘é¡µæ¥è·å–ä¸“ä¸šç­”æ¡ˆï¼`;
        }

        function searchCrawledKnowledge(question) {
            try {
                const knowledgeBase = JSON.parse(localStorage.getItem('crawled_knowledge_base') || '[]');
                const questionLower = question.toLowerCase();
                
                // å¼€å¯è°ƒè¯•æ¨¡å¼ï¼ˆå¯ä»¥é€šè¿‡æ§åˆ¶å°è®¾ç½® window.debugSearch = trueï¼‰
                const debugMode = window.debugSearch || false;
                
                if (debugMode) {
                    console.log('=== æœç´¢è°ƒè¯•ä¿¡æ¯ ===');
                    console.log('é—®é¢˜:', question);
                    console.log('çŸ¥è¯†åº“æ¡ç›®æ•°:', knowledgeBase.length);
                }
                
                if (knowledgeBase.length === 0) {
                    return [];
                }
                
                // æå–å…³é”®è¯
                const keywords = extractKeywords(questionLower);
                if (debugMode) console.log('æå–çš„å…³é”®è¯:', keywords);
                
                // æœç´¢çˆ¬å–çš„å†…å®¹
                const results = knowledgeBase.map((item, index) => {
                    let score = 0;
                    const titleLower = item.title.toLowerCase();
                    const contentLower = item.content.toLowerCase();
                    
                    if (debugMode) {
                        console.log(`\n--- æ£€æŸ¥æ¡ç›® ${index + 1} ---`);
                        console.log('æ ‡é¢˜:', item.title);
                        console.log('å†…å®¹é•¿åº¦:', item.content.length);
                    }
                    
                    // é—®é¢˜å®Œå…¨åŒ¹é…
                    if (titleLower.includes(questionLower)) {
                        score += 25;
                        if (debugMode) console.log('æ ‡é¢˜å®Œå…¨åŒ¹é… +25');
                    }
                    if (contentLower.includes(questionLower)) {
                        score += 20;
                        if (debugMode) console.log('å†…å®¹å®Œå…¨åŒ¹é… +20');
                    }
                    
                    // å…³é”®è¯åŒ¹é…
                    keywords.forEach(keyword => {
                        if (keyword.length >= 2) {
                            if (titleLower.includes(keyword)) {
                                score += 12;
                                if (debugMode) console.log(`æ ‡é¢˜åŒ…å«å…³é”®è¯"${keyword}" +12`);
                            }
                            if (contentLower.includes(keyword)) {
                                score += 8;
                                if (debugMode) console.log(`å†…å®¹åŒ…å«å…³é”®è¯"${keyword}" +8`);
                            }
                        }
                    });
                    
                    // ç‰¹æ®Šå¤„ç†ï¼šäºšé©¬é€Šç›¸å…³è¯æ±‡
                    const amazonKeywords = [
                        'amazon', 'äºšé©¬é€Š', 'fba', 'ä»“å‚¨', 'ç‰©æµ', 'é…é€', 'åˆ†æ‹¨', 'fulfillment',
                        'è¿è¥ä¸­å¿ƒ', 'åº“å­˜', 'è¡¥è´§', 'æ‰¹é‡', 'è§£å†³æ–¹æ¡ˆ', 'prime', 'å•†åŸ'
                    ];
                    
                    amazonKeywords.forEach(keyword => {
                        if (questionLower.includes(keyword)) {
                            if (titleLower.includes(keyword) || contentLower.includes(keyword)) {
                                score += 15;
                                if (debugMode) console.log(`äºšé©¬é€Šå…³é”®è¯"${keyword}"åŒ¹é… +15`);
                            }
                        }
                    });
                    
                    // å¦‚æœæ˜¯äºšé©¬é€Šå–å®¶ä¸­å¿ƒçš„å†…å®¹ï¼Œé¢å¤–åŠ åˆ†
                    if (item.url && item.url.includes('sellercentral.amazon.com')) {
                        score += 10;
                        if (debugMode) console.log('äºšé©¬é€Šå–å®¶ä¸­å¿ƒå†…å®¹ +10');
                    }
                    
                    if (debugMode) console.log(`æ€»åˆ†: ${score}`);
                    return { ...item, score };
                }).filter(item => item.score > 0)
                  .sort((a, b) => b.score - a.score)
                  .slice(0, 3);
                
                // ç®€åŒ–çš„æœç´¢ç»“æœæ—¥å¿—
                console.log(`æœç´¢"${question}": æ‰¾åˆ° ${results.length} ä¸ªåŒ¹é…ç»“æœ`);
                if (results.length > 0) {
                    console.log(`æœ€ä½³åŒ¹é…: "${results[0].title}" (åˆ†æ•°: ${results[0].score})`);
                }
                
                return results;
                
            } catch (error) {
                console.error('æœç´¢çˆ¬å–çŸ¥è¯†åº“æ—¶å‡ºé”™:', error);
                return [];
            }
        }

        function extractKeywords(text) {
            // ç§»é™¤æ ‡ç‚¹ç¬¦å·å’Œåœç”¨è¯
            const stopWords = ['æ˜¯', 'ä»€ä¹ˆ', 'çš„', 'äº†', 'åœ¨', 'æœ‰', 'å’Œ', 'ä¸', 'æˆ–', 'ä½†', 'å¦‚ä½•', 'æ€ä¹ˆ', 'ä¸ºä»€ä¹ˆ', 'å“ªé‡Œ', 'ä»€ä¹ˆæ—¶å€™', 'è°', 'å—', 'å‘¢'];
            
            // åˆ†è¯ï¼ˆç®€å•çš„ä¸­æ–‡åˆ†è¯ï¼‰
            const words = text.replace(/[ï¼Ÿï¼ã€‚ï¼Œã€ï¼›ï¼š""''ï¼ˆï¼‰ã€ã€‘ã€Šã€‹]/g, ' ')
                             .split(/\s+/)
                             .filter(word => word.length > 0 && !stopWords.includes(word));
            
            // æ·»åŠ ä¸€äº›ç»„åˆè¯
            const combinations = [];
            for (let i = 0; i < words.length - 1; i++) {
                if (words[i].length >= 2 && words[i + 1].length >= 2) {
                    combinations.push(words[i] + words[i + 1]);
                }
            }
            
            // ç‰¹æ®Šå¤„ç†ï¼šä¿ç•™é‡è¦çš„çŸ­è¯­
            const importantPhrases = ['ä»“å‚¨æœåŠ¡', 'åˆ†æ‹¨æœåŠ¡', 'ä»“å‚¨å’Œåˆ†æ‹¨', 'è¿è¥ä¸­å¿ƒ', 'è‡ªåŠ¨è¡¥è´§'];
            importantPhrases.forEach(phrase => {
                if (text.includes(phrase)) {
                    combinations.push(phrase);
                }
            });
            
            return [...words, ...combinations];
        }

        function generateAnswerFromCrawledData(question, results) {
            // è¿‡æ»¤æ‰è´¨é‡è¾ƒä½çš„ç»“æœ
            const qualityResults = results.filter(item => {
                // è¿‡æ»¤æ‰å†…å®¹è¿‡çŸ­æˆ–æ˜æ˜¾æ˜¯é¡µé¢å…ƒç´ çš„ç»“æœ
                const content = item.content.trim();
                if (content.length < 50) return false;
                if (content.includes('[iframe]') || content.includes('javascript:void(0)')) return false;
                if (content.match(/^[^a-zA-Z\u4e00-\u9fa5]*$/)) return false; // åªåŒ…å«ç¬¦å·çš„å†…å®¹
                return true;
            });

            if (qualityResults.length === 0) {
                return `ğŸ” æ­£åœ¨æœç´¢çŸ¥è¯†åº“...\n\næŠ±æ­‰ï¼Œè™½ç„¶æ‰¾åˆ°äº†ç›¸å…³å†…å®¹ï¼Œä½†è´¨é‡ä¸å¤Ÿç†æƒ³ã€‚å»ºè®®æ‚¨inputåˆ° <a href="https://quip-amazon.com/rTgtAlsenFdI/SCA-Office-Hour" target="_blank" style="color: #60a5fa; text-decoration: none; border-bottom: 1px solid rgba(96, 165, 250, 0.3);">https://quip-amazon.com/rTgtAlsenFdI/SCA-Office-Hour</a>`;
            }

            // ä½¿ç”¨æœ€ä½³åŒ¹é…ç»“æœ
            const bestResult = qualityResults[0];
            const relevantContent = extractRelevantContent(bestResult.content, question);
            
            // æ¸…ç†å’Œæ ¼å¼åŒ–å†…å®¹
            const cleanContent = cleanAndFormatContent(relevantContent);
            
            let answer = `**${question}**\n\n`;
            answer += `${cleanContent}\n\n`;
            
            // å¦‚æœæœ‰å¤šä¸ªé«˜è´¨é‡ç»“æœï¼Œæ·»åŠ è¡¥å……ä¿¡æ¯
            if (qualityResults.length > 1 && qualityResults[1].score > 20) {
                const supplementContent = extractRelevantContent(qualityResults[1].content, question);
                const cleanSupplement = cleanAndFormatContent(supplementContent);
                if (cleanSupplement.length > 50 && cleanSupplement !== cleanContent) {
                    answer += `**è¡¥å……ä¿¡æ¯ï¼š**\n${cleanSupplement}\n\n`;
                }
            }
            
            // æ·»åŠ æ¥æºä¿¡æ¯
            answer += `ğŸ“š **ä¿¡æ¯æ¥æºï¼š** ${bestResult.title}\n`;
            answer += `ğŸ”— **åŸå§‹é“¾æ¥ï¼š** ${bestResult.url}\n\n`;
            
            // å¦‚æœæœ‰å¤šä¸ªæ¥æºï¼Œåˆ—å‡ºå…¶ä»–æ¥æº
            if (qualityResults.length > 1) {
                answer += `ğŸ“‹ **å…¶ä»–ç›¸å…³æ¥æºï¼š**\n`;
                qualityResults.slice(1, 3).forEach(item => {
                    answer += `â€¢ ${item.title}\n`;
                });
                answer += `\n`;
            }
            
            answer += `ğŸ’¡ éœ€è¦æ›´å¤šä¿¡æ¯ï¼Ÿè®¿é—® <a href="firecrawl-manager.html" target="_blank">FireCrawlç®¡ç†å™¨</a> çˆ¬å–æ›´å¤šç›¸å…³ç½‘é¡µï¼`;
            
            return answer;
        }

        function cleanAndFormatContent(content) {
            // æ¸…ç†å†…å®¹
            let cleaned = content
                // ç§»é™¤HTMLæ ‡ç­¾å’Œç‰¹æ®Šå…ƒç´ 
                .replace(/\[iframe\][^]*/g, '')
                .replace(/javascript:void\(0\)/g, '')
                .replace(/<[^>]*>/g, '')
                .replace(/!\[\]\([^)]*\)/g, '') // ç§»é™¤markdownå›¾ç‰‡
                
                // æ¸…ç†å¤šä½™çš„ç©ºç™½
                .replace(/\n\s*\n\s*\n/g, '\n\n')
                .replace(/[ \t]+/g, ' ')
                .trim();
            
            // å¦‚æœå†…å®¹å¤ªé•¿ï¼Œæ™ºèƒ½æˆªå–
            if (cleaned.length > 800) {
                // å°è¯•åœ¨å¥å·å¤„æˆªæ–­
                const sentences = cleaned.split(/[ã€‚ï¼ï¼Ÿ.!?]/);
                let result = '';
                for (const sentence of sentences) {
                    if ((result + sentence).length > 600) {
                        break;
                    }
                    result += sentence + (sentence.match(/[a-zA-Z]$/) ? '. ' : 'ã€‚');
                }
                cleaned = result || cleaned.substring(0, 600) + '...';
            }
            
            return cleaned;
        }

        function extractRelevantContent(content, question) {
            const questionLower = question.toLowerCase();
            const keywords = extractKeywords(questionLower);
            
            // å°†å†…å®¹åˆ†æˆæ®µè½
            const paragraphs = content.split(/\n\s*\n/).filter(p => p.trim().length > 20);
            
            if (paragraphs.length === 0) {
                return content.substring(0, 500);
            }
            
            // ä¸ºæ¯ä¸ªæ®µè½è¯„åˆ†
            const scoredParagraphs = paragraphs.map(paragraph => {
                let score = 0;
                const paragraphLower = paragraph.toLowerCase();
                
                // å®Œæ•´é—®é¢˜åŒ¹é…
                if (paragraphLower.includes(questionLower.replace(/[ï¼Ÿï¼ã€‚ï¼Œã€ï¼›ï¼š""''ï¼ˆï¼‰ã€ã€‘ã€Šã€‹]/g, ''))) {
                    score += 50;
                }
                
                // å…³é”®è¯åŒ¹é…è¯„åˆ†
                keywords.forEach(keyword => {
                    if (keyword.length >= 2 && paragraphLower.includes(keyword)) {
                        score += keyword.length * 2; // é•¿å…³é”®è¯æƒé‡æ›´é«˜
                    }
                });
                
                // æ®µè½è´¨é‡è¯„åˆ†
                if (paragraph.length > 100 && paragraph.length < 1000) {
                    score += 10; // é€‚ä¸­é•¿åº¦çš„æ®µè½
                }
                
                // é¿å…é€‰æ‹©æ˜æ˜¾çš„å¯¼èˆªæˆ–é¡µé¢å…ƒç´ 
                if (paragraph.includes('iframe') || paragraph.includes('javascript') || 
                    paragraph.match(/^[^a-zA-Z\u4e00-\u9fa5]*$/)) {
                    score = 0;
                }
                
                return { paragraph, score };
            });
            
            // é€‰æ‹©å¾—åˆ†æœ€é«˜çš„æ®µè½
            const bestParagraphs = scoredParagraphs
                .filter(p => p.score > 0)
                .sort((a, b) => b.score - a.score)
                .slice(0, 2) // æœ€å¤šé€‰æ‹©2ä¸ªæ®µè½
                .map(p => p.paragraph);
            
            if (bestParagraphs.length > 0) {
                return bestParagraphs.join('\n\n');
            }
            
            // å¦‚æœæ²¡æœ‰æ‰¾åˆ°ç›¸å…³æ®µè½ï¼Œè¿”å›å¼€å¤´éƒ¨åˆ†
            return content.substring(0, 500);
        }

        function generateBasicAnswer(question) {
            return `æŠ±æ­‰ï¼Œå½“å‰å¤„äºç¦»çº¿æ¨¡å¼ï¼Œæ— æ³•æä¾›è¯¦ç»†å›ç­”ã€‚è¯·æ£€æŸ¥ç½‘ç»œè¿æ¥åé‡è¯•ã€‚\n\næ‚¨çš„é—®é¢˜ï¼š"${question}"\n\nå»ºè®®æ‚¨ç¨åé‡æ–°è®¿é—®æœ¬é¡µé¢ï¼Œæˆ–è€…å°è¯•è¯¢é—®å…³äºäººå·¥æ™ºèƒ½ã€æœºå™¨å­¦ä¹ ã€APIç­‰æŠ€æœ¯è¯é¢˜çš„åŸºç¡€é—®é¢˜ã€‚`;
        }

        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                askQuestion();
            }
        }

        // å…¨å±åŠŸèƒ½
        let isFullscreen = false;

        function toggleFullscreen() {
            console.log('toggleFullscreen called, current state:', isFullscreen);
            const chatContainer = document.getElementById('chatContainer');
            const fullscreenIcon = document.getElementById('fullscreenIcon');
            
            if (!chatContainer || !fullscreenIcon) {
                console.error('Elements not found:', { chatContainer, fullscreenIcon });
                return;
            }
            
            isFullscreen = !isFullscreen;
            console.log('New fullscreen state:', isFullscreen);
            
            if (isFullscreen) {
                // è¿›å…¥å…¨å±
                chatContainer.style.position = 'fixed';
                chatContainer.style.top = '0';
                chatContainer.style.left = '0';
                chatContainer.style.width = '100vw';
                chatContainer.style.height = '100vh';
                chatContainer.style.maxWidth = 'none';
                chatContainer.style.borderRadius = '0';
                chatContainer.style.zIndex = '9999';
                
                fullscreenIcon.innerHTML = '<path d="M5 16h3v3h2v-5H5v2zm3-8H5v2h5V5H8v3zm6 11h2v-3h3v-2h-5v5zm2-11V5h-2v5h5V8h-3z"/>';
                document.getElementById('fullscreenBtn').title = 'é€€å‡ºå…¨å±';
                console.log('Entered fullscreen mode');
            } else {
                // é€€å‡ºå…¨å±
                chatContainer.style.position = 'relative';
                chatContainer.style.top = 'auto';
                chatContainer.style.left = 'auto';
                chatContainer.style.width = '80%';
                chatContainer.style.height = '550px';
                chatContainer.style.maxWidth = '700px';
                chatContainer.style.borderRadius = '24px';
                chatContainer.style.zIndex = 'auto';
                
                fullscreenIcon.innerHTML = '<path d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"/>';
                document.getElementById('fullscreenBtn').title = 'å…¨å±';
                console.log('Exited fullscreen mode');
            }
        }

        // ç›‘å¬ESCé”®é€€å‡ºå…¨å±
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape' && isFullscreen) {
                console.log('ESC key pressed, exiting fullscreen');
                toggleFullscreen();
            }
        });

        // ç®¡ç†å‘˜å¯†ç éªŒè¯
        function checkAdminAccess(targetPage) {
            // æ£€æŸ¥æ˜¯å¦å·²ç»éªŒè¯è¿‡ï¼ˆä¼šè¯å­˜å‚¨ï¼‰
            const isAuthenticated = sessionStorage.getItem('admin_authenticated');
            
            if (isAuthenticated === 'true') {
                window.open(targetPage, '_blank');
                return;
            }
            
            // åˆ›å»ºå¯†ç è¾“å…¥æ¨¡æ€æ¡†
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
                background: rgba(0, 0, 0, 0.8); z-index: 10000; display: flex; 
                align-items: center; justify-content: center; padding: 20px;
                backdrop-filter: blur(10px);
            `;
            
            modal.innerHTML = `
                <div style="
                    background: rgba(15, 23, 42, 0.95); 
                    backdrop-filter: blur(20px);
                    border: 1px solid rgba(255, 255, 255, 0.1);
                    border-radius: 20px; 
                    padding: 40px; 
                    max-width: 400px; 
                    width: 100%;
                    text-align: center;
                    box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
                ">
                    <div style="
                        width: 60px; 
                        height: 60px; 
                        background: linear-gradient(135deg, #ef4444, #dc2626);
                        border-radius: 50%; 
                        margin: 0 auto 20px;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        box-shadow: 0 8px 24px rgba(239, 68, 68, 0.3);
                    ">
                        <svg width="24" height="24" fill="white" viewBox="0 0 24 24">
                            <path d="M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zM9 6c0-1.66 1.34-3 3-3s3 1.34 3 3v2H9V6z"/>
                        </svg>
                    </div>
                    <h3 style="color: #e2e8f0; margin-bottom: 8px; font-size: 1.4rem; font-weight: 600;">ç®¡ç†å‘˜éªŒè¯</h3>
                    <p style="color: rgba(226, 232, 240, 0.7); margin-bottom: 24px; font-size: 14px;">è¯·è¾“å…¥ç®¡ç†å‘˜å¯†ç ä»¥è®¿é—®ç®¡ç†åŠŸèƒ½</p>
                    <input type="password" id="adminPassword" placeholder="è¾“å…¥ç®¡ç†å‘˜å¯†ç " style="
                        width: 100%; 
                        padding: 12px 16px; 
                        background: rgba(255, 255, 255, 0.08);
                        border: 1px solid rgba(255, 255, 255, 0.15);
                        border-radius: 8px; 
                        color: #e2e8f0;
                        font-size: 14px;
                        margin-bottom: 20px;
                        outline: none;
                    ">
                    <div style="display: flex; gap: 12px; justify-content: center;">
                        <button onclick="verifyPassword('${targetPage}', this.parentElement.parentElement.parentElement)" style="
                            padding: 10px 20px;
                            background: linear-gradient(135deg, #4f46e5, #7c3aed);
                            color: white;
                            border: none;
                            border-radius: 8px;
                            cursor: pointer;
                            font-weight: 500;
                            transition: all 0.3s ease;
                        ">ç¡®è®¤</button>
                        <button onclick="this.parentElement.parentElement.parentElement.remove()" style="
                            padding: 10px 20px;
                            background: rgba(255, 255, 255, 0.1);
                            color: #e2e8f0;
                            border: 1px solid rgba(255, 255, 255, 0.2);
                            border-radius: 8px;
                            cursor: pointer;
                            font-weight: 500;
                            transition: all 0.3s ease;
                        ">å–æ¶ˆ</button>
                    </div>
                    <div id="errorMessage" style="
                        color: #ef4444; 
                        font-size: 12px; 
                        margin-top: 12px; 
                        display: none;
                    "></div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // èšç„¦åˆ°å¯†ç è¾“å…¥æ¡†
            setTimeout(() => {
                document.getElementById('adminPassword').focus();
            }, 100);
            
            // æ”¯æŒå›è½¦é”®ç¡®è®¤
            document.getElementById('adminPassword').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    verifyPassword(targetPage, modal);
                }
            });
            
            // ç‚¹å‡»èƒŒæ™¯å…³é—­
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }

        function verifyPassword(targetPage, modal) {
            const password = document.getElementById('adminPassword').value;
            const errorDiv = document.getElementById('errorMessage');
            
            // ç®¡ç†å‘˜å¯†ç ï¼ˆæ‚¨å¯ä»¥ä¿®æ”¹è¿™ä¸ªå¯†ç ï¼‰
            const ADMIN_PASSWORD = 'admin2024';
            
            if (password === ADMIN_PASSWORD) {
                // éªŒè¯æˆåŠŸï¼Œä¿å­˜åˆ°ä¼šè¯å­˜å‚¨
                sessionStorage.setItem('admin_authenticated', 'true');
                modal.remove();
                window.open(targetPage, '_blank');
            } else {
                // éªŒè¯å¤±è´¥
                errorDiv.style.display = 'block';
                errorDiv.textContent = 'å¯†ç é”™è¯¯ï¼Œè¯·é‡è¯•';
                document.getElementById('adminPassword').value = '';
                document.getElementById('adminPassword').focus();
                
                // 3ç§’åéšè—é”™è¯¯ä¿¡æ¯
                setTimeout(() => {
                    errorDiv.style.display = 'none';
                }, 3000);
            }
        }

        // æ˜¾ç¤ºAIé…ç½®ç•Œé¢
        function showAIConfig() {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
                background: rgba(0, 0, 0, 0.8); z-index: 10000; display: flex; 
                align-items: center; justify-content: center; padding: 20px;
                backdrop-filter: blur(10px);
            `;
            
            const currentKey = localStorage.getItem('bedrock_api_key') || '';
            
            modal.innerHTML = `
                <div style="
                    background: rgba(15, 23, 42, 0.95); 
                    backdrop-filter: blur(20px);
                    border: 1px solid rgba(255, 255, 255, 0.1);
                    border-radius: 20px; 
                    padding: 40px; 
                    max-width: 500px; 
                    width: 100%;
                    text-align: center;
                    box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
                ">
                    <div style="
                        width: 60px; 
                        height: 60px; 
                        background: linear-gradient(135deg, #4f46e5, #7c3aed);
                        border-radius: 50%; 
                        margin: 0 auto 20px;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        box-shadow: 0 8px 24px rgba(79, 70, 229, 0.3);
                    ">
                        <svg width="24" height="24" fill="white" viewBox="0 0 24 24">
                            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                        </svg>
                    </div>
                    <h3 style="color: #e2e8f0; margin-bottom: 8px; font-size: 1.4rem; font-weight: 600;">ğŸ¤– AIå¢å¼ºé…ç½®</h3>
                    <p style="color: rgba(226, 232, 240, 0.7); margin-bottom: 24px; font-size: 14px;">é…ç½®Amazon Bedrock APIä»¥å¯ç”¨é«˜çº§AIé—®ç­”åŠŸèƒ½</p>
                    
                    <div style="text-align: left; margin-bottom: 20px;">
                        <label style="color: #e2e8f0; font-size: 13px; margin-bottom: 8px; display: block;">Bedrock API Key:</label>
                        <input type="password" id="bedrockApiKey" value="${currentKey}" placeholder="è¾“å…¥æ‚¨çš„Bedrock APIå¯†é’¥" style="
                            width: 100%; 
                            padding: 12px 16px; 
                            background: rgba(255, 255, 255, 0.08);
                            border: 1px solid rgba(255, 255, 255, 0.15);
                            border-radius: 8px; 
                            color: #e2e8f0;
                            font-size: 14px;
                            outline: none;
                        ">
                    </div>
                    
                    <div style="text-align: left; margin-bottom: 20px;">
                        <label style="color: #e2e8f0; font-size: 13px; margin-bottom: 8px; display: block;">AWS Region:</label>
                        <select id="bedrockRegion" style="
                            width: 100%; 
                            padding: 12px 16px; 
                            background: rgba(255, 255, 255, 0.08);
                            border: 1px solid rgba(255, 255, 255, 0.15);
                            border-radius: 8px; 
                            color: #e2e8f0;
                            font-size: 14px;
                            outline: none;
                        ">
                            <option value="us-east-1">US East (N. Virginia)</option>
                            <option value="us-west-2">US West (Oregon)</option>
                            <option value="eu-west-1">Europe (Ireland)</option>
                            <option value="ap-southeast-1">Asia Pacific (Singapore)</option>
                        </select>
                    </div>
                    
                    <div style="display: flex; gap: 12px; justify-content: center; margin-bottom: 15px;">
                        <button onclick="saveBedrockConfig()" style="
                            padding: 10px 20px;
                            background: linear-gradient(135deg, #4f46e5, #7c3aed);
                            color: white;
                            border: none;
                            border-radius: 8px;
                            cursor: pointer;
                            font-weight: 500;
                            transition: all 0.3s ease;
                        ">ä¿å­˜é…ç½®</button>
                        <button onclick="testBedrockConnection()" style="
                            padding: 10px 20px;
                            background: rgba(16, 185, 129, 0.8);
                            color: white;
                            border: none;
                            border-radius: 8px;
                            cursor: pointer;
                            font-weight: 500;
                            transition: all 0.3s ease;
                        ">æµ‹è¯•è¿æ¥</button>
                        <button onclick="this.parentElement.parentElement.parentElement.remove()" style="
                            padding: 10px 20px;
                            background: rgba(255, 255, 255, 0.1);
                            color: #e2e8f0;
                            border: 1px solid rgba(255, 255, 255, 0.2);
                            border-radius: 8px;
                            cursor: pointer;
                            font-weight: 500;
                            transition: all 0.3s ease;
                        ">å–æ¶ˆ</button>
                    </div>
                    
                    <div id="aiConfigMessage" style="
                        font-size: 12px; 
                        margin-top: 12px; 
                        display: none;
                    "></div>
                    
                    <div style="
                        background: rgba(79, 70, 229, 0.1);
                        border: 1px solid rgba(79, 70, 229, 0.3);
                        border-radius: 8px;
                        padding: 12px;
                        margin-top: 15px;
                        text-align: left;
                    ">
                        <p style="color: rgba(226, 232, 240, 0.8); font-size: 12px; margin: 0;">
                            ğŸ’¡ <strong>æç¤ºï¼š</strong>ä½œä¸ºäºšé©¬é€Šå‘˜å·¥ï¼Œæ‚¨å¯ä»¥é€šè¿‡å†…éƒ¨ç³»ç»Ÿè·å–Bedrock APIè®¿é—®æƒé™ã€‚é…ç½®åå°†å¯ç”¨Claude/Llamaç­‰é«˜çº§AIæ¨¡å‹ï¼Œå¤§å¹…æå‡é—®ç­”è´¨é‡ã€‚
                        </p>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // ç‚¹å‡»èƒŒæ™¯å…³é—­
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }

        // ä¿å­˜Bedrocké…ç½®
        function saveBedrockConfig() {
            const apiKey = document.getElementById('bedrockApiKey').value.trim();
            const region = document.getElementById('bedrockRegion').value;
            const messageDiv = document.getElementById('aiConfigMessage');
            
            if (!apiKey) {
                messageDiv.style.display = 'block';
                messageDiv.style.color = '#ef4444';
                messageDiv.textContent = 'è¯·è¾“å…¥APIå¯†é’¥';
                return;
            }
            
            localStorage.setItem('bedrock_api_key', apiKey);
            localStorage.setItem('bedrock_region', region);
            
            messageDiv.style.display = 'block';
            messageDiv.style.color = '#10b981';
            messageDiv.textContent = 'âœ… é…ç½®å·²ä¿å­˜ï¼Œæ­£åœ¨é‡æ–°æ£€æµ‹APIçŠ¶æ€...';
            
            // é‡æ–°åˆå§‹åŒ–
            setTimeout(() => {
                checkAPIStatus();
                document.querySelector('.modal').remove();
            }, 1500);
        }

        // æµ‹è¯•Bedrockè¿æ¥
        async function testBedrockConnection() {
            const apiKey = document.getElementById('bedrockApiKey').value.trim();
            const region = document.getElementById('bedrockRegion').value;
            const messageDiv = document.getElementById('aiConfigMessage');
            
            if (!apiKey) {
                messageDiv.style.display = 'block';
                messageDiv.style.color = '#ef4444';
                messageDiv.textContent = 'è¯·å…ˆè¾“å…¥APIå¯†é’¥';
                return;
            }
            
            messageDiv.style.display = 'block';
            messageDiv.style.color = '#3b82f6';
            messageDiv.textContent = 'ğŸ”„ æ­£åœ¨æµ‹è¯•è¿æ¥...';
            
            try {
                const testAI = new BedrockAI(region);
                testAI.setApiKey(apiKey);
                const isWorking = await testAI.testConnection();
                
                if (isWorking) {
                    messageDiv.style.color = '#10b981';
                    messageDiv.textContent = 'âœ… è¿æ¥æˆåŠŸï¼Bedrock AIå¯ä»¥æ­£å¸¸ä½¿ç”¨';
                } else {
                    messageDiv.style.color = '#ef4444';
                    messageDiv.textContent = 'âŒ è¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥APIå¯†é’¥å’Œç½‘ç»œ';
                }
            } catch (error) {
                messageDiv.style.color = '#ef4444';
                messageDiv.textContent = `âŒ è¿æ¥å¤±è´¥ï¼š${error.message}`;
            }
        }

        // ä¿å­˜GitHub Modelsé…ç½®
        function saveGitHubConfig() {
            const token = document.getElementById('githubToken').value.trim();
            const model = document.getElementById('githubModel').value;
            const messageDiv = document.getElementById('aiConfigMessage');
            
            if (!token) {
                messageDiv.style.display = 'block';
                messageDiv.style.color = '#ef4444';
                messageDiv.textContent = 'è¯·è¾“å…¥GitHub Token';
                return;
            }
            
            localStorage.setItem('github_models_token', token);
            localStorage.setItem('github_models_current', model);
            
            messageDiv.style.display = 'block';
            messageDiv.style.color = '#10b981';
            messageDiv.textContent = 'âœ… GitHub Modelsé…ç½®å·²ä¿å­˜ï¼Œæ­£åœ¨é‡æ–°æ£€æµ‹APIçŠ¶æ€...';
            
            // é‡æ–°åˆå§‹åŒ–
            setTimeout(() => {
                checkAPIStatus();
                document.querySelector('[style*="position: fixed"]').remove();
            }, 1500);
        }

        // æµ‹è¯•GitHub Modelsè¿æ¥
        async function testGitHubConnection() {
            const token = document.getElementById('githubToken').value.trim();
            const model = document.getElementById('githubModel').value;
            const messageDiv = document.getElementById('aiConfigMessage');
            
            if (!token) {
                messageDiv.style.display = 'block';
                messageDiv.style.color = '#ef4444';
                messageDiv.textContent = 'è¯·å…ˆè¾“å…¥GitHub Token';
                return;
            }
            
            messageDiv.style.display = 'block';
            messageDiv.style.color = '#3b82f6';
            messageDiv.textContent = 'ğŸ”„ æ­£åœ¨æµ‹è¯•GitHub Modelsè¿æ¥...';
            
            try {
                const testAI = new GitHubModelsAI();
                testAI.setApiKey(token);
                testAI.setModel(model);
                const isWorking = await testAI.testConnection();
                
                if (isWorking) {
                    messageDiv.style.color = '#10b981';
                    messageDiv.textContent = `âœ… è¿æ¥æˆåŠŸï¼GitHub Models (${model}) å¯ä»¥æ­£å¸¸ä½¿ç”¨`;
                } else {
                    messageDiv.style.color = '#ef4444';
                    messageDiv.textContent = 'âŒ è¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥Tokenæƒé™å’Œç½‘ç»œ';
                }
            } catch (error) {
                messageDiv.style.color = '#ef4444';
                messageDiv.textContent = `âŒ è¿æ¥å¤±è´¥ï¼š${error.message}`;
            }
        }

        window.onload = function() {
            document.getElementById('questionInput').focus();
            checkAPIStatus();
        };
    </script>
</body>
</html>
